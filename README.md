# BigComp 门禁控制系统

## 📋 项目简介

这是一个完整的门禁控制系统原型，用于管理和监控建筑物内各种资源（门、电梯、打印机等）的访问权限。系统支持用户管理、权限配置、实时监控、日志记录等功能。

## 🚀 快速开始

### 前置要求

- **Java 21** 或更高版本
- **Maven 3.6** 或更高版本

### 安装步骤

1. **检查Java版本**
   ```bash
   java -version
   # 应该显示 Java 21 或更高版本
   ```

2. **检查Maven版本**
   ```bash
   mvn -version
   # 应该显示 Maven 3.6 或更高版本
   ```

3. **编译项目**
   ```bash
   mvn compile
   ```

4. **运行项目**
   ```bash
   mvn exec:java -Dexec.mainClass="com.bigcomp.accesscontrol.Main"
   ```
   
   或者打包后运行：
   ```bash
   mvn package
   java -jar target/access-control-system-1.0.0.jar
   ```

## 📖 使用指南

### 主界面介绍

启动程序后，您会看到一个包含6个标签页的主窗口：

1. **用户管理** - 管理用户和徽章
2. **资源管理** - 管理资源和读卡器
3. **配置文件** - 管理访问权限配置
4. **实时监控** - 查看实时访问事件
5. **日志查看** - 搜索和查看历史日志
6. **事件模拟** - 模拟访问事件进行测试

---

## 🔧 详细功能说明

### 1. 用户管理

#### 添加用户

1. 在"用户管理"标签页中，填写用户信息：
   - **名**：用户的名字
   - **姓**：用户的姓氏
   - **性别**：选择性别（男性/女性/其他）
   - **类型**：选择用户类型
     - `EMPLOYEE` - 正式员工
     - `CONTRACTOR` - 承包商
     - `INTERN` - 实习生
     - `VISITOR` - 访客
     - `PROJECT_MANAGER` - 项目经理

2. 点击"添加用户"按钮
3. 用户将出现在下方的用户列表中

#### 创建徽章

1. 在用户列表中选择一个用户
2. 点击"创建徽章"按钮
3. 系统会自动生成一个唯一的徽章代码并关联到该用户

**注意**：只有拥有徽章的用户才能进行访问控制。

#### 分配配置文件

1. 确保用户已创建徽章
2. 在用户列表中选择用户
3. 点击"分配配置文件"按钮
4. 从下拉列表中选择要分配的配置文件
5. 配置文件定义了用户可以访问哪些资源组以及在什么时间可以访问

#### 删除用户

1. 在用户列表中选择要删除的用户
2. 点击"删除用户"按钮
3. 确认删除操作
4. **注意**：删除用户会同时删除该用户的徽章和相关配置

---

### 2. 资源管理

#### 添加资源

1. 在"资源管理"标签页中，填写资源信息：
   - **名称**：资源名称（如"主入口"、"电梯1"等）
   - **类型**：选择资源类型
     - `DOOR` - 门
     - `GATE` - 大门
     - `ELEVATOR` - 电梯
     - `STAIRWAY` - 楼梯
     - `PRINTER` - 打印机
     - `BEVERAGE_DISPENSER` - 饮料机
     - `PARKING` - 停车场
   - **位置**：资源位置描述
   - **建筑**：所属建筑名称
   - **楼层**：所在楼层

2. 点击"添加资源"按钮

#### 创建读卡器

1. 在资源列表中选择一个资源
2. 点击"创建读卡器"按钮
3. 系统会创建一个读卡器并关联到该资源
4. 读卡器用于接收用户的刷卡请求

#### 删除资源

1. 在资源列表中选择要删除的资源
2. 点击"删除资源"按钮
3. 确认删除操作
4. **注意**：删除资源会同时删除关联的读卡器和资源组关联

---

### 3. 配置文件管理

配置文件定义了用户可以访问哪些资源组以及在什么时间可以访问。

#### 创建配置文件

1. 在"配置文件"标签页中，点击"新建配置文件"
2. 输入配置文件名称（如"员工权限"、"访客权限"等）
3. 配置文件将出现在左侧列表中

#### 添加访问权限

1. 在左侧列表中选择一个配置文件
2. 在"资源组"下拉框中选择资源组
3. 点击"添加访问权限"
4. 权限将出现在中间的表格中

#### 编辑时间过滤器

1. 在访问权限表格中选择一个权限
2. 点击"编辑时间过滤器"按钮
3. 在弹出对话框中设置：
   - **允许的星期**：勾选允许访问的星期（周一到周日）
   - **时间范围**：设置允许访问的时间段（如 8:00 至 18:00）
   - **排除模式**：
     - 勾选"排除选中的星期"：表示不允许在选中的星期访问
     - 勾选"排除时间范围"：表示不允许在设置的时间范围内访问

4. 点击"确定"保存设置

**时间过滤器示例**：
- **工作日访问**：选择周一到周五，时间范围 8:00-18:00
- **周末访问**：选择周六和周日，不设置时间范围（表示全天）
- **排除午休时间**：选择所有星期，时间范围 12:00-13:00，勾选"排除时间范围"

#### 保存配置文件

1. 编辑完配置文件后，点击"保存配置文件"按钮
2. 配置文件会自动保存到 `data/profiles/` 目录

---

### 4. 资源组管理

资源组用于将具有相同安全级别的资源分组管理。

#### 创建资源组（通过JSON文件）

1. 在 `data/groups/` 目录下创建JSON文件，例如 `office.json`：
   ```json
   {
     "name": "办公室区域",
     "securityLevel": 1,
     "resources": ["resource-id-1", "resource-id-2"]
   }
   ```

2. 重启程序后，资源组会自动加载

#### 关联资源到组

资源与组的关联可以通过数据库直接操作，或在资源管理界面中实现（需要扩展功能）。

---

### 5. 实时监控

#### 查看场地平面图

1. 在"实时监控"标签页中，从"视图"下拉框选择"场地平面图"
2. 系统会显示场地布局图
3. 蓝色圆点表示读卡器位置
4. 当有访问尝试时：
   - **绿色闪烁点** = 访问被授权
   - **红色闪烁点** = 访问被拒绝

#### 查看楼层平面图

1. 从"视图"下拉框选择"办公楼楼层图"
2. 系统会显示楼层布局图
3. 可以查看各个办公室、会议室、电梯等资源的位置

#### 查看实时事件日志

右侧面板会实时显示所有访问事件，包括：
- 时间戳
- 读卡器ID
- 资源ID
- 授权状态

---

### 6. 日志查看

#### 搜索日志

1. 在"日志查看"标签页中，设置搜索条件：
   - **开始日期**：格式 `yyyy-MM-dd`（如 `2024-01-01`）
   - **结束日期**：格式 `yyyy-MM-dd`
   - **徽章代码**：可选，筛选特定徽章
   - **资源ID**：可选，筛选特定资源
   - **用户ID**：可选，筛选特定用户
   - **状态**：全部/授权/拒绝

2. 点击"搜索"按钮
3. 结果会显示在下方的表格中

#### 导出日志

1. 先执行搜索获取要导出的日志
2. 点击"导出日志"按钮
3. 选择保存位置和文件名
4. 日志会以CSV格式导出，可以用Excel打开

---

### 7. 事件模拟

用于测试系统功能，模拟用户刷卡行为。

#### 添加模拟用户

1. 在"事件模拟"标签页中，左侧显示所有用户
2. 选择一个或多个用户
3. 点击"添加用户"按钮
4. 用户会添加到模拟用户列表中

#### 开始模拟

1. 确保已添加至少一个模拟用户
2. 确保有可用的读卡器
3. 点击"开始模拟"按钮
4. 系统会每2秒随机生成一个访问事件
5. 可以在"实时监控"标签页中查看模拟的访问尝试

#### 停止模拟

1. 点击"停止模拟"按钮
2. 模拟会立即停止

#### 移除模拟用户

1. 点击"移除用户"按钮
2. 从列表中选择要移除的用户
3. 用户会从模拟列表中移除

---

## 📁 数据存储

系统数据存储在以下位置：

- **数据库**：`data/access_control.db` (SQLite数据库)
  - 存储用户、徽章、资源、读卡器等数据
  
- **配置文件**：`data/profiles/` 目录
  - 每个配置文件保存为一个JSON文件
  
- **资源组**：`data/groups/` 目录
  - 每个资源组保存为一个JSON文件
  
- **日志文件**：`data/logs/年/月/日期.csv`
  - 按年/月/日组织，例如：`data/logs/2024/01/2024-01-15.csv`

---

## 🔄 典型工作流程

### 场景1：添加新员工并授予访问权限

1. **添加用户**
   - 进入"用户管理"标签页
   - 填写员工信息，类型选择 `EMPLOYEE`
   - 点击"添加用户"

2. **创建徽章**
   - 选择刚添加的用户
   - 点击"创建徽章"

3. **创建配置文件**（如果还没有）
   - 进入"配置文件"标签页
   - 点击"新建配置文件"，命名为"员工权限"
   - 添加访问权限，选择资源组
   - 编辑时间过滤器（如：工作日 8:00-18:00）
   - 保存配置文件

4. **分配配置文件**
   - 回到"用户管理"标签页
   - 选择用户，点击"分配配置文件"
   - 选择"员工权限"配置文件

5. **完成**：员工现在可以在指定时间访问指定资源

### 场景2：添加新资源并配置访问控制

1. **添加资源**
   - 进入"资源管理"标签页
   - 填写资源信息（如：名称="服务器室"，类型=DOOR）
   - 点击"添加资源"

2. **创建读卡器**
   - 选择刚添加的资源
   - 点击"创建读卡器"

3. **创建资源组**（如果需要）
   - 在 `data/groups/` 目录创建JSON文件
   - 将资源ID添加到资源组中

4. **配置访问权限**
   - 进入"配置文件"标签页
   - 编辑相关配置文件，添加新资源组的访问权限
   - 设置时间过滤器（如：仅工作日，仅工作时间）

5. **完成**：资源已配置访问控制

### 场景3：查看访问记录

1. **查看实时访问**
   - 进入"实时监控"标签页
   - 观察访问尝试的实时反馈（绿色/红色闪烁点）

2. **搜索历史日志**
   - 进入"日志查看"标签页
   - 设置日期范围和其他筛选条件
   - 点击"搜索"

3. **导出日志**
   - 搜索完成后，点击"导出日志"
   - 选择保存位置
   - 用Excel打开CSV文件进行分析

---

## ⚠️ 注意事项

1. **首次运行**：系统会自动创建数据库和必要的目录结构

2. **数据备份**：定期备份 `data/` 目录，特别是 `access_control.db` 文件

3. **配置文件格式**：配置文件使用JSON格式，手动编辑时请确保格式正确

4. **时间过滤器**：
   - 如果不选择任何星期，表示允许所有星期
   - 如果不设置时间范围，表示允许所有时间
   - 排除模式会反转选择逻辑

5. **访问控制流程**：
   - 用户必须有徽章
   - 徽章必须关联配置文件
   - 资源必须属于某个资源组
   - 配置文件必须包含该资源组的访问权限
   - 访问时间必须符合时间过滤器规则

---

## 🐛 常见问题

### Q: 添加用户后看不到？
**A**: 确保用户已创建徽章。系统默认只显示有徽章的用户。使用 `loadAllUsers()` 方法可以显示所有用户。

### Q: 访问总是被拒绝？
**A**: 检查以下几点：
1. 用户是否有徽章？
2. 徽章是否关联了配置文件？
3. 资源是否属于某个资源组？
4. 配置文件是否包含该资源组的权限？
5. 当前时间是否符合时间过滤器规则？

### Q: 日志搜索不到结果？
**A**: 
1. 检查日期格式是否正确（`yyyy-MM-dd`）
2. 确认该日期有访问事件发生
3. 检查筛选条件是否过于严格

### Q: 配置文件保存失败？
**A**: 
1. 检查 `data/profiles/` 目录是否存在且有写权限
2. 确保配置文件名称不包含特殊字符

### Q: 模拟器不工作？
**A**: 
1. 确保已添加模拟用户
2. 确保有可用的读卡器
3. 检查模拟器是否已启动

---

## 📚 技术架构

### 系统组件

- **模型层** (`model/`)：数据模型（User, Badge, Resource等）
- **核心层** (`core/`)：业务逻辑（访问控制、路由等）
- **数据库层** (`database/`)：数据持久化
- **配置文件层** (`profile/`)：权限配置管理
- **日志层** (`logging/`)：访问日志记录
- **GUI层** (`gui/`)：图形用户界面
- **模拟层** (`simulation/`)：事件模拟

### 数据流程

1. **访问请求**：用户刷卡 → 读卡器 → 路由器
2. **权限验证**：路由器 → 访问请求处理器 → 检查权限
3. **响应处理**：处理器 → 路由器 → 读卡器 → 控制资源
4. **日志记录**：所有访问事件自动记录到日志文件

---

## 🔧 开发说明

### 编译项目
```bash
mvn clean compile
```

### 运行测试
```bash
mvn test
```

### 打包项目
```bash
mvn clean package
```

### 项目结构
```
chenlab/
├── pom.xml                          # Maven配置
├── README.md                        # 本文件
├── data/                            # 数据目录（自动创建）
│   ├── access_control.db           # SQLite数据库
│   ├── profiles/                    # 配置文件目录
│   ├── groups/                     # 资源组目录
│   └── logs/                       # 日志目录
└── src/main/java/...               # 源代码
```

---

## 📝 版本信息

- **版本**：1.0.0
- **Java版本**：21
- **数据库**：SQLite 3.44.1.0
- **JSON处理**：Jackson 2.16.0

---

## 📚 详细文档

- **配置文件使用指南**：`配置文件使用指南.md` - 详细说明如何创建和使用配置文件
- **文件存储说明**：`文件存储说明.md` - 说明所有文件的存储位置和格式

---

## 📞 支持

如有问题或建议，请查看代码注释或联系开发团队。

---

## 📄 许可证

本项目为原型系统，仅供学习和演示使用。
